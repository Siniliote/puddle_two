{% extends 'base.html.twig' %}

{% block title %}Chat{% endblock %}

{% block body %}
    <div {{ stimulus_controller('send-message', {
        'url-mercure' : mercure('https://localhost/channel/' ~ channel.id)
    }) }}>
        {% if app.user %}
            <div>
                You are logged in as {{ app.user.username }}, <a href="{{ path('app_logout') }}">Logout</a>
            </div>
        {% endif %}
        <h1>Channel {{ channel.name }}</h1>
        <div>
            <div class="container bg-light h-75 overflow-auto">
                {% for message in messages %}
                    {% if app.user == message.author %}
                        <div class="row w-75 float-right">
                            <b>{{ message.author.username }}</b>
                            <p class="alert alert-info w-100">
                                {{ message.content }}
                            </p>
                        </div>
                    {% else %}
                        <div class="row w-75 float-left">
                            <b>{{ message.author.username }}</b>
                            <p class="alert alert-success w-100">
                                {{ message.content }}
                            </p>
                        </div>
                    {% endif %}
                {% endfor %}
                <template {{ stimulus_target('send-message', 'template') }}>
                    <div>
                        <b></b>
                        <p class="alert alert-success w-100"></p>
                    </div>
                </template>
            </div>
            <div>
                <form id="form">
                    <label for="message">Message: </label><input id="message" placeholder="Message" type="text" {{ stimulus_target('send-message', 'message') }}/>
                    <button id="submit" type="submit" {{ stimulus_action('send-message', 'submitForm', 'click') }}
                            data-send-message-id-param='{{ channel.id }}'
                            data-send-message-url-param='{{ path('message') }}'
                    >Send</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
